#!/usr/bin/env pwsh
$basedir = Split-Path $MyInvocation.MyCommand.Definition -Parent

# Inicializar la variable $exe dependiendo de la versión de PowerShell y el sistema operativo
$exe = if ($PSVersionTable.PSVersion -lt "6.0" -or $IsWindows) { ".exe" } else { $null }

# Función para ejecutar el script de Node.js
function Invoke-Node {
    param (
        [string]$nodePath
    )
    if ($MyInvocation.ExpectingInput) {
        $input | & $nodePath "$basedir/../mime/cli.js" $args
    } else {
        & $nodePath "$basedir/../mime/cli.js" $args
    }
    return $LASTEXITCODE
}

# Verificar si se usa el node local o global
$nodeExec = "$basedir/node$exe"
if (Test-Path $nodeExec) {
    $ret = Invoke-Node $nodeExec
} else {
    $ret = Invoke-Node "node$exe"
}

exit $ret
